


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000 E000ED04 
                       NVIC_INT_CTRL
                               EQU              0xE000ED04  ; ÖÐ¶Ï¿ØÖÆ¼Ä´æÆ÷
    3 00000000 E000ED22 
                       NVIC_SYSPRI14
                               EQU              0xE000ED22  ; ÏµÍ³ÓÅÏÈ¼¶¼Ä´æÆ÷(
                                                            ÓÅÏÈ¼¶14).
    4 00000000 000000FF 
                       NVIC_PENDSV_PRI
                               EQU              0xFF        ; PendSVÓÅÏÈ¼¶(×îµÍ
                                                            ).
    5 00000000 10000000 
                       NVIC_PENDSVSET
                               EQU              0x10000000  ; PendSV´¥·¢Öµ
    6 00000000         
    7 00000000                 PRESERVE8                    ;8×Ö½Ú¶ÔÆë£¿
    8 00000000                 THUMB
    9 00000000         
   10 00000000                 AREA             CODE, CODE, READONLY
   11 00000000         
   12 00000000                 EXTERN           CPU_ExceptStkBase ;Ö÷¶ÑÕ»
   13 00000000         
   14 00000000                 EXTERN           p_TCB_Cur   ;Ö¸ÏòTCBµÄµÄÖ¸Õë
   15 00000000                 EXTERN           p_TCBHightRdy ;Ö¸Ïò×î¸ßÓÅÏÈ¼¶ÈÎ
                                                            ÎñµÄÖ¸Õë
   16 00000000         
   17 00000000                 EXPORT           OSStartHighRdy
   18 00000000                 EXPORT           PendSV_Handler 
                                                            ;PendSVÒì³£´¦Àíº¯Êý
                                                            
   19 00000000                 EXPORT           OSCtxSw
   20 00000000                 EXPORT           OS_CPU_SR_Save
   21 00000000                 EXPORT           OS_CPU_SR_Restore
   22 00000000         
   23 00000000         OS_CPU_SR_Save                       ;PRIMASK   ÕâÊÇ¸öÖ»
                                                            ÓÐµ¥Ò»±ÈÌØµÄ¼Ä´æÆ÷¡
                                                            £ÔÚËü±»ÖÃ1ºó£¬¾Í¹Øµ
                                                            ôËùÓÐ¿ÉÆÁ±ÎµÄÒì³££¬
                                                            Ö»Ê£ÏÂNMIºÍÓ²fault¿
                                                            ÉÒÔÏìÓ¦¡£ËüµÄÈ±Ê¡Öµ
                                                            ÊÇ0£¬±íÊ¾Ã»ÓÐ¹ØÖÐ¶Ï
                                                            
   24 00000000 F3EF 8010       MRS              R0, PRIMASK ;¶ÁÈ¡PRIMASKµ½R0,R0
                                                            Îª·µ»ØÖµ 
   25 00000004 B672            CPSID            I           ;PRIMASK=1,¹ØÖÐ¶Ï(N
                                                            MIºÍÓ²¼þFAULT¿ÉÒÔÏì
                                                            Ó¦)
   26 00000006 4770            BX               LR          ;·µ»Ø
   27 00000008         
   28 00000008         OS_CPU_SR_Restore
   29 00000008 F380 8810       MSR              PRIMASK, R0 ;¶ÁÈ¡R0µ½PRIMASKÖÐ,
                                                            R0Îª²ÎÊý
   30 0000000C 4770            BX               LR          ;·µ»Ø
   31 0000000E         
   32 0000000E         OSCtxSw
   33 0000000E 481B            LDR              R0,=NVIC_INT_CTRL
   34 00000010 F04F 5180       LDR              R1,=NVIC_PENDSVSET
   35 00000014 6001            STR              R1,[R0]     ;´¥·¢PendSV



ARM Macro Assembler    Page 2 


   36 00000016 4770            BX               LR
   37 00000018         
   38 00000018         OSStartHighRdy                       ; ÉèÖÃPendSVµÄÒì³£Ö
                                                            Ð¶ÏÓÅÏÈ¼¶
   39 00000018 4819            LDR              R0,=NVIC_SYSPRI14
   40 0000001A F04F 01FF       LDR              R1,=NVIC_PENDSV_PRI
   41 0000001E 7001            STRB             R1,[R0]
   42 00000020         
   43 00000020 2000            MOVS             R0,#0       ;ÈÎÎñ¶ÑÕ»ÉèÖÃÎª0
   44 00000022 F380 8809       MSR              PSP,R0      ;PSPÇåÁã£¬×÷ÎªÊ×´ÎÉ
                                                            ÏÏÂÎÄÇÐ»»µÄ±êÖ¾
   45 00000026         
   46 00000026 4817            LDR              R0,=CPU_ExceptStkBase ;³õÊ¼»¯¶Ñ
                                                            Õ»ÎªCPU_ExceptStkBa
                                                            se
   47 00000028 6801            LDR              R1,[R0]     ;R1µÄÊý¾Ý+R2µÄÊý¾Ýº
                                                            Ï³ÉÒ»¸öµØÖ·Öµ£¬¸ÃµØ
                                                            Ö·ÖÐ´æ·ÅµÄÊý¾Ý¸³Öµ¸
                                                            øR0
   48 0000002A F381 8808       MSR              MSP,R1      ;½«MSPÉèÎªÎÒÃÇÎªÆä·
                                                            ÖÅäµÄÄÚ´æµØÖ·CPU_Ex
                                                            ceptStkBase
   49 0000002E         
   50 0000002E 4813            LDR              R0,=NVIC_INT_CTRL
   51 00000030 F04F 5180       LDR              R1,=NVIC_PENDSVSET
   52 00000034 6001            STR              R1,[R0]     ; ´¥·¢PendSVÒì³£
   53 00000036         
   54 00000036 B662            CPSIE            I           ;¿ªÆôÖÐ¶Ï
   55 00000038         
   56 00000038         
   57 00000038         
   58 00000038         
   59 00000038         
   60 00000038         
   61 00000038         PendSV_Handler
   62 00000038 B672            CPSID            I           ; ¹ØÖÐ¶Ï
   63 0000003A F3EF 8009       MRS              R0,PSP      ;°ÑPSPÖ¸ÕëµÄÖµ¸³¸øR
                                                            0
   64 0000003E B150            CBZ              R0,OS_CPU_PendSV_Handler_nosave
 
                                                            ;Èç¹ûPSPÎª0µ÷µ½OS_C
                                                            PU_PendSV_Handler_n
                                                            osave
   65 00000040         
   66 00000040         ;Is the task using the FPU context? If so, push high vfp
                        registers.
   67 00000040 F01E 0F10       TST              R14, #0x10
   68 00000044 BF08            IT               EQ
   69 00000046 ED20 8A10       VSTMDBEQ         R0!, {S16-S31}
   70 0000004A         
   71 0000004A 3820            SUBS             R0,R0,#0x20
   72 0000004C E880 0FF0       STM              R0,{R4-R11} ; ÈëÕ»R4-R11
   73 00000050         
   74 00000050 490D            LDR              R1,=p_TCB_Cur ;ÔÚÕâÀïÎÒÃÇÈëÕ»ÁË
                                                            ºÜ¶à¼Ä´æÆ÷  ;µ±Ç°ÈÎ
                                                            ÎñµÄÖ¸Õë
   75 00000052 6809            LDR              R1,[R1]     ;ÕâÈý¾äÈÃp_TCB_Cur-
                                                            >StkPtrÖ¸ÏòÐÂµÄÕ»¶¥
                                                            



ARM Macro Assembler    Page 3 


   76 00000054 6008            STR              R0,[R1]     ;¼´p_TCB_Cur->StkPt
                                                            r=SP
   77 00000056         
   78 00000056         OS_CPU_PendSV_Handler_nosave
   79 00000056 480C            LDR              R0,=p_TCB_Cur ;p_TCB_Cur=p_TCBH
                                                            ightRdy
   80 00000058 490C            LDR              R1,=p_TCBHightRdy
   81 0000005A 680A            LDR              R2,[R1]
   82 0000005C 6002            STR              R2,[R0]     ;½«R2µÄÖµÐ´Èëµ½¡¾R0
                                                            ¡¿µÄµØÖ·ÖÐ
   83 0000005E         
   84 0000005E 6810            LDR              R0,[R2]     ;½«ÐÂµÄÕ»¶¥¸øSP,SP=
                                                            p_TCB_Cur->StkPtr
   85 00000060         
   86 00000060 E890 0FF0       LDM              R0,{R4-R11} ; µ¯³öR4-R11
   87 00000064 3020            ADDS             R0,R0,#0x20
   88 00000066         
   89 00000066         ;Is the task using the FPU context? If so, push high vfp
                        registers.
   90 00000066 F01E 0F10       TST              R14, #0x10
   91 0000006A BF08            IT               EQ
   92 0000006C ECB0 8A10       VLDMIAEQ         R0!, {S16-S31}
   93 00000070         
   94 00000070 F380 8809       MSR              PSP,R0      ;¸üÐÂPSP;ÓÐÁ½¸ö¶ÑÕ»
                                                            ¼Ä´æÆ÷£¬Ö÷¶ÑÕ»Ö¸Õë£
                                                            ¨MSP£©Óë½ø³Ì¶ÑÕ»Ö¸Õ
                                                            ë£¨PSP£©£¬¶øÇÒÈÎÒ»Ê
                                                            ±¿ÌÖ»ÄÜÊ¹ÓÃÆäÖÐµÄÒ»
                                                            ¸ö¡£MSPÎª¸´Î»ºóÈ±Ê¡
                                                            Ê¹ÓÃµÄ¶ÑÕ»Ö¸Õë£¬Òì³
                                                            £ÓÀÔ¶Ê¹ÓÃMSP£¬Èç¹ûÊ
                                                            Ö¶¯¿ªÆôPSP£¬ÄÇÃ´Ïß³
                                                            ÌÊ¹ÓÃPSP£¬·ñÔòÒ²Ê¹Ó
                                                            ÃMSP¡£ÔõÃ´¿ªÆôPSP£¿
                                                            
   95 00000074 F04E 0E04       ORR              LR,LR,#0x04 ;ÖÃLRµÄÎ»2Îª1£¬ÄÇÃ´
                                                            Òì³£·µ»Øºó£¬Ïß³ÌÊ¹Ó
                                                            ÃPSP
   96 00000078         
   97 00000078 B662            CPSIE            I           ;¿ªÖÐ¶Ï
   98 0000007A         ;Í¨³£Ò»¸öº¯Êýµ÷ÓÃÁíÒ»¸öº¯ÊýÊ±»áÊ¹ÓÃBLÖ¸Áî£¬Õâ¸öÖ¸Áî»á°Ñµ
                       ±Ç°µÄPC·Åµ½LR¼Ä´æÆ÷
   99 0000007A 4770            BX               LR          ;°ÑLR¼Ä´æÆ÷µÄÄÚÈÝ¸´
                                                            ÖÆµ½PC¼Ä´æÆ÷Àï £¬´Ó
                                                            ¶øÊµÏÖº¯ÊýµÄ·µ»Ø
  100 0000007C         ;ÔÚÖÐ¶Ï³öÏÖÊ±£¬LR¼Ä´æÆ÷»áÉèÎªÒ»¸öÌØÊâµÄÖµ£¨º¯Êý·µ»ØµØÖ·£
                       ©£¬¶ø²»ÊÇÖÐ¶ÏÖ®Ç°µÄPC¼Ä´æÆ÷ÄÚÈÝ£¬ÕâÑù£¬µ±ÖÐ¶Ïº¯ÊýÊ¹ÓÃBX 
                       LRÖ¸Áî·µ»ØÊ± £¬CPU¾ÍÄÜ¹»ÖªµÀÊÇÖÐ¶Ïº¯Êý·µ»ØÁË
  101 0000007C         
  102 0000007C                 END
              E000ED04 
              E000ED22 
              00000000 
              00000000 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\output\core.d -o.\output\core.o -I.\RTE\_Competition2019 -IC:
\Keil_v5\ARM\PACK\Keil\STM32F4xx_DFP\2.13.0\Drivers\CMSIS\Device\ST\STM32F4xx\I
nclude -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\PACK\Keil\STM32F4xx_DFP\



ARM Macro Assembler    Page 4 


2.13.0\Device\Include --predefine="__UVISION_VERSION SETA 528" --predefine="STM
32F407xx SETA 1" --list=.\output\core.lst _05_Os\core.asm



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

CODE 00000000

Symbol: CODE
   Definitions
      At line 10 in file _05_Os\core.asm
   Uses
      None
Comment: CODE unused
OSCtxSw 0000000E

Symbol: OSCtxSw
   Definitions
      At line 32 in file _05_Os\core.asm
   Uses
      At line 19 in file _05_Os\core.asm
Comment: OSCtxSw used once
OSStartHighRdy 00000018

Symbol: OSStartHighRdy
   Definitions
      At line 38 in file _05_Os\core.asm
   Uses
      At line 17 in file _05_Os\core.asm
Comment: OSStartHighRdy used once
OS_CPU_PendSV_Handler_nosave 00000056

Symbol: OS_CPU_PendSV_Handler_nosave
   Definitions
      At line 78 in file _05_Os\core.asm
   Uses
      At line 64 in file _05_Os\core.asm
Comment: OS_CPU_PendSV_Handler_nosave used once
OS_CPU_SR_Restore 00000008

Symbol: OS_CPU_SR_Restore
   Definitions
      At line 28 in file _05_Os\core.asm
   Uses
      At line 21 in file _05_Os\core.asm
Comment: OS_CPU_SR_Restore used once
OS_CPU_SR_Save 00000000

Symbol: OS_CPU_SR_Save
   Definitions
      At line 23 in file _05_Os\core.asm
   Uses
      At line 20 in file _05_Os\core.asm
Comment: OS_CPU_SR_Save used once
PendSV_Handler 00000038

Symbol: PendSV_Handler
   Definitions
      At line 61 in file _05_Os\core.asm
   Uses
      At line 18 in file _05_Os\core.asm
Comment: PendSV_Handler used once
7 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

NVIC_INT_CTRL E000ED04

Symbol: NVIC_INT_CTRL
   Definitions
      At line 2 in file _05_Os\core.asm
   Uses
      At line 33 in file _05_Os\core.asm
      At line 50 in file _05_Os\core.asm

NVIC_PENDSVSET 10000000

Symbol: NVIC_PENDSVSET
   Definitions
      At line 5 in file _05_Os\core.asm
   Uses
      At line 34 in file _05_Os\core.asm
      At line 51 in file _05_Os\core.asm

NVIC_PENDSV_PRI 000000FF

Symbol: NVIC_PENDSV_PRI
   Definitions
      At line 4 in file _05_Os\core.asm
   Uses
      At line 40 in file _05_Os\core.asm
Comment: NVIC_PENDSV_PRI used once
NVIC_SYSPRI14 E000ED22

Symbol: NVIC_SYSPRI14
   Definitions
      At line 3 in file _05_Os\core.asm
   Uses
      At line 39 in file _05_Os\core.asm
Comment: NVIC_SYSPRI14 used once
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

CPU_ExceptStkBase 00000000

Symbol: CPU_ExceptStkBase
   Definitions
      At line 12 in file _05_Os\core.asm
   Uses
      At line 46 in file _05_Os\core.asm
Comment: CPU_ExceptStkBase used once
p_TCBHightRdy 00000000

Symbol: p_TCBHightRdy
   Definitions
      At line 15 in file _05_Os\core.asm
   Uses
      At line 80 in file _05_Os\core.asm
Comment: p_TCBHightRdy used once
p_TCB_Cur 00000000

Symbol: p_TCB_Cur
   Definitions
      At line 14 in file _05_Os\core.asm
   Uses
      At line 74 in file _05_Os\core.asm
      At line 79 in file _05_Os\core.asm

3 symbols
349 symbols in table
